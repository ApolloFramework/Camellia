EXTRA_ARGS=$@

rm -f CMakeCache.txt
rm -rf CMakeFiles

#complex support incompatible with SuperLU_Dist + Amesos2 combination -- hence the Teuchos_ENABLE_COMPLEX:BOOL=OFF line
#removed -D Trilinos_ENABLE_OpenMP:BOOL=ON \ because it doesn't perform well...

cmake \
-D Trilinos_WARNINGS_AS_ERRORS_FLAGS:STRING="" \
-D TPL_ENABLE_BLAS:BOOL=ON \
-D TPL_ENABLE_LAPACK:BOOL=ON \
-D BLAS_LIBRARY_NAMES="mkl_intel_lp64;mkl_sequential;mkl_core" \
-D BLAS_LIBRARY_DIRS=$TACC_MKL_LIB \
-D LAPACK_LIBRARY_NAMES="" \
-D LAPACK_LIBRARY_DIRS=$TACC_MKL_LIB \
-D TPL_ENABLE_MPI:BOOL=ON \
-D TPL_ENABLE_HDF5:STRING=ON \
-D HDF5_INCLUDE_DIRS:FILEPATH=$TACC_HDF5_INC \
-D HDF5_LIBRARY_DIRS:FILEPATH=$TACC_HDF5_LIB \
-D HDF5_LIBRARY_NAMES:STRING="hdf5" \
-D TPL_ENABLE_MUMPS:STRING=ON \
-D MUMPS_LIBRARY_DIRS:FILEPATH=$PETSC_DIR/$PETSC_ARCH/lib \
-D MUMPS_LIBRARY_NAMES:STRING="dmumps; pord; mumps_common" \
-D MUMPS_INCLUDE_DIRS:FILEPATH=$PETSC_DIR/$PETSC_ARCH/include \
-D TPL_ENABLE_SuperLUDist:STRING=ON \
-D SuperLUDist_LIBRARY_DIRS:FILEPATH="$PETSC_DIR/$PETSC_ARCH/lib" \
-D SuperLUDist_LIBRARY_NAMES:STRING="superlu_dist_4.0" \
-D TPL_SuperLUDist_INCLUDE_DIRS:FILEPATH="$PETSC_DIR/$PETSC_ARCH/include" \
-D HAVE_SUPERLUDIST_LUSTRUCTINIT_2ARG:BOOL=ON \
-D TPL_ENABLE_METIS:STRING=ON \
-D METIS_LIBRARY_DIRS:FILEPATH="$PETSC_DIR/$PETSC_ARCH/lib" \
-D METIS_LIBRARY_NAMES:STRING="metis" \
-D METIS_INCLUDE_DIRS:FILEPATH="$PETSC_DIR/$PETSC_ARCH/include" \
-D TPL_ENABLE_ParMETIS:STRING=ON \
-D ParMETIS_LIBRARY_DIRS:FILEPATH="$PETSC_DIR/$PETSC_ARCH/lib" \
-D ParMETIS_LIBRARY_NAMES:STRING="parmetis" \
-D ParMETIS_INCLUDE_DIRS:FILEPATH="$PETSC_DIR/$PETSC_ARCH/include" \
-D CMAKE_CXX_COMPILER:FILEPATH=mpicxx \
-D CMAKE_C_COMPILER:FILEPATH=mpicc \
-D CMAKE_Fortran_COMPILER:FILEPATH=mpif90 \
-D CMAKE_CXX_FLAGS_RELEASE:STRING="-g -O3 -qopenmp" \
-D CMAKE_C_FLAGS_RELEASE:STRING="-g -O3 -qopenmp" \
-D MPI_BASE_DIR:PATH=$MPICH_HOME/lib \
-D HAVE_GCC_ABI_DEMANGLE:BOOL=ON \
-D DART_TESTING_TIMEOUT:STRING=600 \
-D CMAKE_VERBOSE_MAKEFILE:BOOL=TRUE \
-D Trilinos_ENABLE_Anasazi:BOOL=ON \
-D Trilinos_ENABLE_Amesos:BOOL=ON \
-D Trilinos_ENABLE_Amesos2:BOOL=ON \
-D Teuchos_ENABLE_COMPLEX:BOOL=OFF \
-D Amesos2_ENABLE_KLU2:BOOL=ON \
-D Trilinos_ENABLE_Belos:BOOL=ON \
-D Trilinos_ENABLE_Intrepid:BOOL=ON \
-D Trilinos_ENABLE_Sacado:BOOL=ON \
-D Trilinos_ENABLE_Epetra:BOOL=ON \
-D Trilinos_ENABLE_EpetraExt:BOOL=ON \
-D EpetraExt_USING_HDF5:BOOL=ON \
-D Trilinos_ENABLE_Teuchos:BOOL=ON \
-D Trilinos_ENABLE_Shards:BOOL=ON \
-D Trilinos_ENABLE_Zoltan:BOOL=ON \
-D Trilinos_ENABLE_ML:BOOL=ON \
-D Trilinos_ENABLE_TESTS:BOOL=OFF \
-D Trilinos_SKIP_FORTRANCINTERFACE_VERIFY_TEST:BOOL=ON \
-DTrilinos_ASSERT_MISSING_PACKAGES=OFF \
-D CMAKE_INSTALL_PREFIX:PATH=$WORK/Trilinos_lib \
$EXTRA_ARGS \
$HOME/Trilinos/Trilinos


#####
-D BLAS_LIBRARY_NAMES="mkl_intel_lp64;mkl_sequential;mkl_core" \
-D BLAS_LIBRARY_DIRS=$TACC_MKL_LIB \
-D LAPACK_LIBRARY_NAMES="" \
-D LAPACK_LIBRARY_DIRS=$TACC_MKL_LIB \

